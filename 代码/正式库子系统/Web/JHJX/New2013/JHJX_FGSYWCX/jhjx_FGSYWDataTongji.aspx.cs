using FMOP.DB;
using Hesion.Brick.Core;
using System;
using System.Collections.Generic;
using System.Data;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class Web_JHJX_New2013_JHJX_FGSYWCX_jhjx_FGSYWDataTongji : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

    }
    protected void btntongji_Click(object sender, EventArgs e)
    {
        //获取所有分公司及其数据需要绑定的数据结构
        string Stralldata = "declare @zhou1 varchar(10),@zhou2 varchar(10) set  @zhou1 = (select convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120))  set   @zhou2 = (select convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120)) SELECT ROW_NUMBER() over( order by Number) as '序号', DYFGSMC as '所属分公司',(select  ISNULL (COUNT ( distinct b.Number),0)   from  AAA_MJMJJYZHYJJRZHGLB as b left join AAA_DLZHXXB as a on b.DLYX=a.B_DLYX where JSZHLX='经纪人交易账户' and  DATEDIFF(DAY, b.FGSSHSJ,GETDATE()) = 0  and b.SFSCGLJJR = '是' and b.FGSSHZT='审核通过' and a.I_PTGLJG=DYFGSMC  ) as '经纪人本日新增',(select  ISNULL (COUNT ( distinct b.Number),0)   from  AAA_MJMJJYZHYJJRZHGLB as b left join AAA_DLZHXXB as a on b.DLYX=a.B_DLYX where JSZHLX='经纪人交易账户' and  (b.FGSSHSJ >= @zhou1 and b.FGSSHSJ <= @zhou2 ) and b.SFSCGLJJR = '是' and b.FGSSHZT='审核通过' and a.I_PTGLJG=DYFGSMC  ) as '经纪人本周新增',(select  ISNULL (COUNT ( distinct b.Number),0)   from  AAA_MJMJJYZHYJJRZHGLB as b left join AAA_DLZHXXB as a on b.DLYX=a.B_DLYX where JSZHLX='经纪人交易账户' and  DATEDIFF(MONTH, b.FGSSHSJ,GETDATE()) = 0  and b.SFSCGLJJR = '是' and b.FGSSHZT='审核通过' and a.I_PTGLJG=DYFGSMC ) as '经纪人本月新增',(select  ISNULL (COUNT ( distinct b.Number),0)   from  AAA_MJMJJYZHYJJRZHGLB as b left join AAA_DLZHXXB as a on b.DLYX=a.B_DLYX where JSZHLX='经纪人交易账户' and  DATEDIFF(YEAR, b.FGSSHSJ,GETDATE()) = 0  and b.SFSCGLJJR = '是' and b.FGSSHZT='审核通过' and a.I_PTGLJG=DYFGSMC  ) as '经纪人本年新增',( select count (*) from  (( select  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC  group by  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG ) union (select Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG ) ) as bbb) as '有效经纪人本日新增',(select count (*) from  (( select  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and YSTBDGLJJRPTGLJG=System_City.DYFGSMC  group by  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG ) union (select Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= @zhou1 and Z_DBSJ <=@zhou2 ) and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG ) ) as bbb) as '有效经纪人本周新增',( select count (*) from  (( select  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE())=0  and YSTBDGLJJRPTGLJG=System_City.DYFGSMC  group by  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG ) union (select Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG ) ) as bbb) as '有效经纪人本月新增',( select count (*) from  (( select  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC  group by  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG ) union (select Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG ) ) as bbb) as 有效经纪人本年新增 ,( select count (*) from  ( select  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG= System_City.DYFGSMC group by  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  ) as bbb) as '有效卖家本日新增',(select count (*) from  ( select  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= @zhou1 and Z_DBSJ <= @zhou2 ) and YSTBDGLJJRPTGLJG= System_City.DYFGSMC group by  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  ) as bbb) as '有效卖家本周新增',(select count (*) from  ( select  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG= System_City.DYFGSMC group by  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  ) as bbb) as '有效卖家本月新增',(select count (*) from  ( select  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG= System_City.DYFGSMC group by  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  ) as bbb) as '有效卖家本年新增',( select count (*) from  ( select  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  ) as bbb)  as '有效买家本日新增',( select count (*) from  ( select  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= @zhou1 and Z_DBSJ <= @zhou2 )  and YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  ) as bbb)  as '有效买家本周新增', ( select count (*) from  ( select  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  ) as bbb)  as '有效买家本月新增',( select count (*) from  ( select  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  ) as bbb)  as '有效买家本年新增',(select count (*) from  (( select  Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC group by Z_SPMC,Z_GG ) union (select Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Z_SPMC,Z_GG ) ) as bbb) as '定标商品品类数量本日新增',(select count (*) from  (( select  Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and YSTBDGLJJRPTGLJG=System_City.DYFGSMC group by Z_SPMC,Z_GG ) union (select Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= @zhou1 and Z_DBSJ <= @zhou2 ) and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Z_SPMC,Z_GG ) ) as bbb) as '定标商品品类数量本周新增',(select count (*) from  (( select  Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC group by Z_SPMC,Z_GG ) union (select Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Z_SPMC,Z_GG ) ) as bbb) as '定标商品品类数量本月新增',(select count (*) from  (( select  Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC group by Z_SPMC,Z_GG ) union (select Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Z_SPMC,Z_GG ) ) as bbb) as '定标商品品类数量本年新增',(   select   ISNULL( sum( isnull(Z_ZBSL,0)),0)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)  ) as '定标数量本日新增',(   select   ISNULL( sum( isnull(Z_ZBSL,0)),0)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= @zhou1 and Z_DBSJ <= @zhou2 ) and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)  ) as '定标数量本周新增',(  select   ISNULL( sum( isnull(Z_ZBSL,0)),0) from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC) ) as '定标数量本月新增',( select   ISNULL( sum( isnull(Z_ZBSL,0)),0)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)) as '定标数量本年新增',(   select   ISNULL( sum( isnull(Z_ZBJE,0.00)),0.00)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)  ) as '定标金额本日新增',(   select    ISNULL( sum( isnull(Z_ZBJE,0.00)),0.00)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= @zhou1 and Z_DBSJ <= @zhou2 ) and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)  ) as '定标金额本周新增',(  select   ISNULL( sum( isnull(Z_ZBJE,0.00)),0.00)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC) ) as '定标金额本月新增',( select   ISNULL( sum( isnull(Z_ZBJE,0.00)),0.00)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)) as '定标金额本年新增'  FROM System_City where DYFGSMC != '' and name<>'其他办事处' ";
     //   string  = " SELECT ROW_NUMBER() over( order by Number) as '序号', DYFGSMC as '所属分公司',(select  ISNULL (COUNT ( distinct b.Number),0)   from  AAA_MJMJJYZHYJJRZHGLB as b left join AAA_DLZHXXB as a on b.DLYX=a.B_DLYX where JSZHLX='经纪人交易账户' and  DATEDIFF(DAY, b.FGSSHSJ,GETDATE()) = 0  and b.SFSCGLJJR = '是' and b.FGSSHZT='审核通过' and a.I_PTGLJG=DYFGSMC  ) as '经纪人本日新增',(select  ISNULL (COUNT ( distinct b.Number),0)   from  AAA_MJMJJYZHYJJRZHGLB as b left join AAA_DLZHXXB as a on b.DLYX=a.B_DLYX where JSZHLX='经纪人交易账户' and  (b.FGSSHSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and b.FGSSHSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and b.SFSCGLJJR = '是' and b.FGSSHZT='审核通过' and a.I_PTGLJG=DYFGSMC  ) as '经纪人本周新增',(select  ISNULL (COUNT ( distinct b.Number),0)   from  AAA_MJMJJYZHYJJRZHGLB as b left join AAA_DLZHXXB as a on b.DLYX=a.B_DLYX where JSZHLX='经纪人交易账户' and  DATEDIFF(MONTH, b.FGSSHSJ,GETDATE()) = 0  and b.SFSCGLJJR = '是' and b.FGSSHZT='审核通过' and a.I_PTGLJG=DYFGSMC ) as '经纪人本月新增',(select  ISNULL (COUNT ( distinct b.Number),0)   from  AAA_MJMJJYZHYJJRZHGLB as b left join AAA_DLZHXXB as a on b.DLYX=a.B_DLYX where JSZHLX='经纪人交易账户' and  DATEDIFF(YEAR, b.FGSSHSJ,GETDATE()) = 0  and b.SFSCGLJJR = '是' and b.FGSSHZT='审核通过' and a.I_PTGLJG=DYFGSMC  ) as '经纪人本年新增',( select count (*) from  (( select  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC  group by  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG ) union (select Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG ) ) as bbb) as '有效经纪人本日新增',(select count (*) from  (( select  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and YSTBDGLJJRPTGLJG=System_City.DYFGSMC  group by  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG ) union (select Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG ) ) as bbb) as '有效经纪人本周新增',( select count (*) from  (( select  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE())=0  and YSTBDGLJJRPTGLJG=System_City.DYFGSMC  group by  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG ) union (select Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG ) ) as bbb) as '有效经纪人本月新增',( select count (*) from  (( select  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC  group by  T_YSTBDGLJJRJSBH,YSTBDGLJJRPTGLJG ) union (select Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Y_YSYDDGLJJRJSBH,YSYDDGLJJRPTGLJG ) ) as bbb) as 有效经纪人本年新增 ,( select count (*) from  ( select  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG= System_City.DYFGSMC group by  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  ) as bbb) as '有效卖家本日新增',(select count (*) from  ( select  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and YSTBDGLJJRPTGLJG= System_City.DYFGSMC group by  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  ) as bbb) as '有效卖家本周新增',(select count (*) from  ( select  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG= System_City.DYFGSMC group by  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  ) as bbb) as '有效卖家本月新增',(select count (*) from  ( select  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG= System_City.DYFGSMC group by  T_YSTBDMJJSBH,YSTBDGLJJRPTGLJG  ) as bbb) as '有效卖家本年新增',( select count (*) from  ( select  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  ) as bbb)  as '有效买家本日新增',( select count (*) from  ( select  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) )  and YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  ) as bbb)  as '有效买家本周新增', ( select count (*) from  ( select  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  ) as bbb)  as '有效买家本月新增',( select count (*) from  ( select  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by  Y_YSYDDMJJSBH,YSYDDGLJJRPTGLJG  ) as bbb)  as '有效买家本年新增',(select count (*) from  (( select  Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC group by Z_SPMC,Z_GG ) union (select Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Z_SPMC,Z_GG ) ) as bbb) as '定标商品品类数量本日新增',(select count (*) from  (( select  Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and YSTBDGLJJRPTGLJG=System_City.DYFGSMC group by Z_SPMC,Z_GG ) union (select Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Z_SPMC,Z_GG ) ) as bbb) as '定标商品品类数量本周新增',(select count (*) from  (( select  Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC group by Z_SPMC,Z_GG ) union (select Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Z_SPMC,Z_GG ) ) as bbb) as '定标商品品类数量本月新增',(select count (*) from  (( select  Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and YSTBDGLJJRPTGLJG=System_City.DYFGSMC group by Z_SPMC,Z_GG ) union (select Z_SPMC,Z_GG  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and  YSYDDGLJJRPTGLJG=System_City.DYFGSMC  group by Z_SPMC,Z_GG ) ) as bbb) as '定标商品品类数量本年新增',(   select   ISNULL( sum( isnull(Z_ZBSL,0)),0)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)  ) as '定标数量本日新增',(   select   ISNULL( sum( isnull(Z_ZBSL,0)),0)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)  ) as '定标数量本周新增',(  select   ISNULL( sum( isnull(Z_ZBSL,0)),0) from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC) ) as '定标数量本月新增',( select   ISNULL( sum( isnull(Z_ZBSL,0)),0)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)) as '定标数量本年新增',(   select   ISNULL( sum( isnull(Z_ZBJE,0.00)),0.00)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(DAY,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)  ) as '定标金额本日新增',(   select    ISNULL( sum( isnull(Z_ZBJE,0.00)),0.00)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and (Z_DBSJ >= convert(varchar(10),getdate()-(datepart(dw,getdate())-2),120) and Z_DBSJ <= convert(varchar(10),getdate()+(8-datepart(dw,getdate())),120) ) and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)  ) as '定标金额本周新增',(  select   ISNULL( sum( isnull(Z_ZBJE,0.00)),0.00)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(MONTH,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC) ) as '定标金额本月新增',( select   ISNULL( sum( isnull(Z_ZBJE,0.00)),0.00)  from AAA_ZBDBXXB where AAA_ZBDBXXB.Z_HTZT in ( '定标','定标合同到期','定标合同终止','定标执行完成') and DATEDIFF(YEAR,Z_DBSJ,GETDATE()) = 0 and (YSTBDGLJJRPTGLJG=System_City.DYFGSMC or  YSYDDGLJJRPTGLJG =System_City.DYFGSMC)) as '定标金额本年新增'  FROM System_City where DYFGSMC != '' and name<>'其他办事处'  ";

        DataSet ds = DbHelperSQL.Query(Stralldata);
        if (ds != null && ds.Tables[0].Rows.Count > 0)
        {
            this.Label1.Text = ds.Tables[0].Compute("sum(经纪人本日新增)", "true").ToString();
            this.Label2.Text = ds.Tables[0].Compute("sum(经纪人本周新增)", "true").ToString();
            this.Label3.Text = ds.Tables[0].Compute("sum(经纪人本月新增)", "true").ToString();
            this.Label4.Text = ds.Tables[0].Compute("sum(经纪人本年新增)", "true").ToString();
            this.Label5.Text = ds.Tables[0].Compute("sum(有效经纪人本日新增)", "true").ToString();
            this.Label6.Text = ds.Tables[0].Compute("sum(有效经纪人本周新增)", "true").ToString();
            this.Label7.Text = ds.Tables[0].Compute("sum(有效经纪人本月新增)", "true").ToString();
            this.Label8.Text = ds.Tables[0].Compute("sum(有效经纪人本年新增)", "true").ToString();
            this.Label9.Text = ds.Tables[0].Compute("sum(有效卖家本日新增)", "true").ToString();
            this.Label10.Text = ds.Tables[0].Compute("sum(有效卖家本周新增)", "true").ToString();
            this.Label11.Text = ds.Tables[0].Compute("sum(有效卖家本月新增)", "true").ToString();
            this.Label12.Text = ds.Tables[0].Compute("sum(有效卖家本年新增)", "true").ToString();
            this.Label13.Text = ds.Tables[0].Compute("sum(有效买家本日新增)", "true").ToString();
            this.Label14.Text = ds.Tables[0].Compute("sum(有效买家本周新增)", "true").ToString();
            this.Label15.Text = ds.Tables[0].Compute("sum(有效买家本月新增)", "true").ToString();
            this.Label16.Text = ds.Tables[0].Compute("sum(有效买家本年新增)", "true").ToString();
            this.Label17.Text = ds.Tables[0].Compute("sum(定标商品品类数量本日新增)", "true").ToString();
            this.Label18.Text = ds.Tables[0].Compute("sum(定标商品品类数量本周新增)", "true").ToString();
            this.Label19.Text = ds.Tables[0].Compute("sum(定标商品品类数量本月新增)", "true").ToString();
            this.Label20.Text = ds.Tables[0].Compute("sum(定标商品品类数量本年新增)", "true").ToString();
            this.Label21.Text = ds.Tables[0].Compute("sum(定标数量本日新增)", "true").ToString();
            this.Label22.Text = ds.Tables[0].Compute("sum(定标数量本周新增)", "true").ToString();
            this.Label23.Text = ds.Tables[0].Compute("sum(定标数量本月新增)", "true").ToString();
            this.Label24.Text = ds.Tables[0].Compute("sum(定标数量本年新增)", "true").ToString();
            this.Label25.Text = ds.Tables[0].Compute("sum(定标金额本日新增)", "true").ToString();
            this.Label26.Text = ds.Tables[0].Compute("sum(定标金额本周新增)", "true").ToString();
            this.Label27.Text = ds.Tables[0].Compute("sum(定标金额本月新增)", "true").ToString();
            this.Label28.Text = ds.Tables[0].Compute("sum(定标金额本年新增)", "true").ToString();
        }
        rptFWS.DataSource = ds;
        rptFWS.DataBind();
        Repeater1.DataSource = ds;
        Repeater1.DataBind();


        this.Label29.Text = ds.Tables[0].Compute("sum(经纪人本日新增)", "true").ToString();
        this.Label30.Text = ds.Tables[0].Compute("sum(经纪人本周新增)", "true").ToString();
        this.Label31.Text = ds.Tables[0].Compute("sum(经纪人本月新增)", "true").ToString();
        this.Label32.Text = ds.Tables[0].Compute("sum(经纪人本年新增)", "true").ToString();
        this.Label33.Text = ds.Tables[0].Compute("sum(有效经纪人本日新增)", "true").ToString();
        this.Label34.Text = ds.Tables[0].Compute("sum(有效经纪人本周新增)", "true").ToString();
        this.Label35.Text = ds.Tables[0].Compute("sum(有效经纪人本月新增)", "true").ToString();
        this.Label36.Text = ds.Tables[0].Compute("sum(有效经纪人本年新增)", "true").ToString();
        this.Label37.Text = ds.Tables[0].Compute("sum(有效卖家本日新增)", "true").ToString();
        this.Label38.Text = ds.Tables[0].Compute("sum(有效卖家本周新增)", "true").ToString();
        this.Label39.Text = ds.Tables[0].Compute("sum(有效卖家本月新增)", "true").ToString();
        this.Label40.Text = ds.Tables[0].Compute("sum(有效卖家本年新增)", "true").ToString();
        this.Label41.Text = ds.Tables[0].Compute("sum(有效买家本日新增)", "true").ToString();
        this.Label42.Text = ds.Tables[0].Compute("sum(有效买家本周新增)", "true").ToString();
        this.Label43.Text = ds.Tables[0].Compute("sum(有效买家本月新增)", "true").ToString();
        this.Label44.Text = ds.Tables[0].Compute("sum(有效买家本年新增)", "true").ToString();
        this.Label45.Text = ds.Tables[0].Compute("sum(定标商品品类数量本日新增)", "true").ToString();
        this.Label46.Text = ds.Tables[0].Compute("sum(定标商品品类数量本周新增)", "true").ToString();
        this.Label47.Text = ds.Tables[0].Compute("sum(定标商品品类数量本月新增)", "true").ToString();
        this.Label48.Text = ds.Tables[0].Compute("sum(定标商品品类数量本年新增)", "true").ToString();
        this.Label49.Text = ds.Tables[0].Compute("sum(定标数量本日新增)", "true").ToString();
        this.Label50.Text = ds.Tables[0].Compute("sum(定标数量本周新增)", "true").ToString();
        this.Label51.Text = ds.Tables[0].Compute("sum(定标数量本月新增)", "true").ToString();
        this.Label52.Text = ds.Tables[0].Compute("sum(定标数量本年新增)", "true").ToString();
        this.Label53.Text = ds.Tables[0].Compute("sum(定标金额本日新增)", "true").ToString();
        this.Label54.Text = ds.Tables[0].Compute("sum(定标金额本周新增)", "true").ToString();
        this.Label55.Text = ds.Tables[0].Compute("sum(定标金额本月新增)", "true").ToString();
        this.Label56.Text = ds.Tables[0].Compute("sum(定标金额本年新增)", "true").ToString();
    }
    protected void btndaochu_Click(object sender, EventArgs e)
    {
        if (rptFWS != null && rptFWS.Items.Count > 0)
        {
            HttpContext.Current.Response.Clear();

            HttpContext.Current.Response.Charset = "";
            string filename = " 分公司业务数据统计" + System.DateTime.Now.ToString("_yyyyMMddHHmm");
            HttpContext.Current.Response.AppendHeader("Content-Disposition", "attachment;filename=" +

            System.Web.HttpUtility.UrlEncode(filename, System.Text.Encoding.UTF8) + ".xls");

            HttpContext.Current.Response.ContentEncoding = System.Text.Encoding.UTF8;
            HttpContext.Current.Response.ContentType = "application/ms-excel";//image/JPEG;text/HTML;image/GIF;vnd.ms-excel/msword   

            export.Page.EnableViewState = false;
            System.IO.StringWriter tw = new System.IO.StringWriter();
            System.Web.UI.HtmlTextWriter hw = new System.Web.UI.HtmlTextWriter(tw);
            #region//asp.net 导出Excel时，解决纯数字字符串变成类似这样的 2.00908E+18 形式的代码
            string strStyle = "<style>td{vnd.ms-excel.numberformat: @;}</style>";//导出的数字的样式
            tw.WriteLine(strStyle);
            #endregion

            export.RenderControl(hw);
            HttpContext.Current.Response.Write(tw.ToString());
            HttpContext.Current.Response.End();
        }
        else
        {
            MessageBox.ShowAlertAndBack(this, "请输入您要查找的用户交易方账号或者交易方名称！");
        }

    }

    // 导出Exel时需重载此方法
    public override void VerifyRenderingInServerForm(Control control)
    {
        //base.VerifyRenderingInServerForm(control);
    }
}